Overview

This page documents the lifecycle of the AKS Command Invoke Deny Policy, including its initial rollout, rollback due to provider limitations, and the recent changes that enable re-enforcement in DTAP environments.

ğŸ” What is "Command Invoke"?

"Command Invoke" refers to the use of Azure CLI to remotely execute commands on AKS clusters using:

az aks command invoke --resource-group <RG_Name> --name <CLUSTER_NAME> --command "<kubectl-command>"


While this is a powerful feature, it poses security risks if not tightly controlled, as it allows remote command execution within clusters.

ğŸ“… Policy Rollout Timeline
âœ… Initial Deny Policy Rollout

Date: 25th August 2025
Change:
We rolled out a Deny Policy on all AKS clusters to block use of the kubectl run-command feature, aiming to:

Limit potential security exposure from remote command execution.

Align with Kubernetes cluster hardening best practices.

Enforce stricter control over cluster operations.

ğŸ”„ Temporary Rollback of Deny Policy

Date: 3rd September 2025
Reason:
An issue was identified with the Terraform azurerm provider during AKS resource updates.

Terraform required parameters during the plan phase but failed during the apply phase due to blocked access by the deny policy.

This caused legitimate resource updates to fail.

Action Taken:

The policy mode was temporarily switched from "Deny" to "Audit" to unblock operations while the root cause was being addressed.

ğŸ” Policy Update and Re-enforcement

Date: October 2025 (Planned)
Whatâ€™s Changed:

The issue with the Terraform provider has been resolved.

The policy effect is now changed to "Modify", which offers greater flexibility by:

Allowing specific operations when necessary.

Still restricting unauthorized or risky command usage.

Upcoming Action:

The updated policy will be pushed to DTAP environments.

Future rollout to PROD will follow after stability confirmation.
